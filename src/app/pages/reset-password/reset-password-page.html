<div class="auth-page">
  <div class="auth-bg">
    <div class="auth-bg-gradient"></div>
    <div class="auth-bg-pattern"></div>
  </div>

  <div class="lang-switcher">
    <button
      class="lang-btn"
      [class.active]="activeLang() === 'ro'"
      (click)="switchLang('ro')">
      RO
    </button>
    <button
      class="lang-btn"
      [class.active]="activeLang() === 'ru'"
      (click)="switchLang('ru')">
      RU
    </button>
  </div>

  <div class="auth-container">
    <a [routerLink]="['/', activeLang()]" class="auth-logo">Secret Room</a>

    <div class="auth-card">
      <!-- Success State -->
      @if (success()) {
        <div class="auth-card-header">
          <h1>{{ 'resetPassword.successTitle' | transloco }}</h1>
          <p>{{ 'resetPassword.successMessage' | transloco }}</p>
        </div>
        <button class="auth-submit" (click)="goToLogin()">
          {{ 'resetPassword.goToLogin' | transloco }}
          <i class="ri-arrow-right-line"></i>
        </button>
      }

      <!-- Invalid/Expired Token -->
      @else if (errorMessage() && !token) {
        <div class="auth-card-header">
          <h1>{{ 'resetPassword.title' | transloco }}</h1>
        </div>
        <div class="auth-error">
          <i class="ri-error-warning-line"></i>
          {{ errorMessage() | transloco }}
        </div>
        <button class="auth-submit" style="margin-top: 1.5rem" (click)="goToLogin()">
          {{ 'resetPassword.goToLogin' | transloco }}
          <i class="ri-arrow-right-line"></i>
        </button>
      }

      <!-- Reset Form -->
      @else {
        <div class="auth-card-header">
          <h1>{{ 'resetPassword.title' | transloco }}</h1>
          <p>{{ 'resetPassword.description' | transloco }}</p>
        </div>

        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="auth-form">
          <!-- New Password -->
          <div class="form-group" [class.has-error]="isFieldInvalid('password')" [class.has-value]="hasValue('password')">
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="password"
              formControlName="password"
              autocomplete="new-password">
            <label for="password">
              {{ 'resetPassword.newPassword' | transloco }}
              <span class="required">*</span>
            </label>
            <div class="input-line"></div>
            <i
              class="field-icon toggle-password"
              [class.ri-eye-line]="!showPassword"
              [class.ri-eye-off-line]="showPassword"
              (click)="showPassword = !showPassword"></i>
            @if (isFieldInvalid('password')) {
              <span class="error-text">{{ 'resetPassword.passwordRequirements' | transloco }}</span>
            }
          </div>

          <!-- Confirm Password -->
          <div class="form-group" [class.has-error]="isFieldInvalid('passwordConfirmation') || (form.hasError('passwordsMismatch') && form.get('passwordConfirmation')?.touched)" [class.has-value]="hasValue('passwordConfirmation')">
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              id="passwordConfirmation"
              formControlName="passwordConfirmation"
              autocomplete="new-password">
            <label for="passwordConfirmation">
              {{ 'resetPassword.confirmPassword' | transloco }}
              <span class="required">*</span>
            </label>
            <div class="input-line"></div>
            <i
              class="field-icon toggle-password"
              [class.ri-eye-line]="!showConfirmPassword"
              [class.ri-eye-off-line]="showConfirmPassword"
              (click)="showConfirmPassword = !showConfirmPassword"></i>
            @if (form.hasError('passwordsMismatch') && form.get('passwordConfirmation')?.touched) {
              <span class="error-text">{{ 'resetPassword.passwordsMismatch' | transloco }}</span>
            }
          </div>

          <!-- Error message -->
          @if (errorMessage()) {
            <div class="auth-error">
              <i class="ri-error-warning-line"></i>
              {{ errorMessage() | transloco }}
            </div>
          }

          <!-- Submit -->
          <button type="submit" class="auth-submit" [disabled]="submitting()">
            @if (submitting()) {
              <span class="spinner"></span>
              {{ 'resetPassword.processing' | transloco }}
            } @else {
              {{ 'resetPassword.submit' | transloco }}
              <i class="ri-arrow-right-line"></i>
            }
          </button>
        </form>
      }
    </div>

    <a [routerLink]="['/', activeLang(), 'login']" class="back-home">
      <i class="ri-arrow-left-line"></i>
      {{ 'resetPassword.backToLogin' | transloco }}
    </a>
  </div>
</div>
