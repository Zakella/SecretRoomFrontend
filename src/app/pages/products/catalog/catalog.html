<div appFadeUp class="catalog-page">
  <h1 class="visually-hidden">
    @if (brandAlias() || brandName()) {
      {{ brandAlias() || brandName() }}
    } @else if (categoryName()) {
      {{ categoryName() }}
    } @else {
      Catalog
    }
    — Secret Room Moldova
  </h1>

  @if (hasFilters()) {
    <div class="mobile-filter-bar">
      <button class="mobile-filter-btn" (click)="openFilterDrawer()">
        <i class="ri-equalizer-line"></i>
        {{ 'Filters' | transloco }}
        @if (activeFilterCount() > 0) {
          <span class="filter-badge">{{ activeFilterCount() }}</span>
        }
      </button>
    </div>
  }

  <!-- MOBILE: active filter tags -->
  @if (hasFilters() && activeFilterCount() > 0) {
    <div class="mobile-active-filters">
      @if (selectedBrand()) {
        <button class="active-filter-tag" (click)="selectBrand(null)">
          {{ selectedBrand() }}
          <i class="ri-close-line"></i>
        </button>
      }
      @for (group of availableFilters(); track group.slug) {
        @for (v of group.values; track v.slug) {
          @if (isFilterSelected(group.slug, v.slug)) {
            <button class="active-filter-tag" (click)="toggleFilter(group.slug, v.slug)">
              {{ v | localizedName:'value' }}
              <i class="ri-close-line"></i>
            </button>
          }
        }
      }
      <button class="clear-all-tag" (click)="clearAllFilters()">
        {{ 'ClearAll' | transloco }}
      </button>
    </div>
  }

  <!-- MOBILE: Filter Drawer -->
  <p-drawer [(visible)]="filterDrawerVisible" [fullScreen]="true" styleClass="filter-drawer">
    <ng-template pTemplate="header">
      <div class="filter-drawer-header">
        <span class="filter-drawer-title">{{ 'Filters' | transloco }}</span>
        @if (pendingFilterCount() > 0) {
          <button class="filter-drawer-clear" (click)="clearPendingFilters()">
            {{ 'ClearAll' | transloco }}
          </button>
        }
      </div>
    </ng-template>

    <div class="filter-drawer-content">
      @if (availableBrands().length > 1) {
        <div class="filter-drawer-section">
          <div class="filter-drawer-section-title" (click)="brandSectionOpen = !brandSectionOpen">
            <span>{{ 'Brand' | transloco }}</span>
            <i [class]="brandSectionOpen ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
          </div>
          @if (brandSectionOpen) {
            <div class="filter-drawer-options">
              <button class="filter-drawer-option"
                      [class.selected]="pendingBrand() === null"
                      (click)="selectPendingBrand(null)">
                <span class="option-check">
                  @if (pendingBrand() === null) { <i class="ri-checkbox-circle-fill"></i> }
                </span>
                {{ 'AllBrands' | transloco }}
              </button>
              @for (b of availableBrands(); track b.brand) {
                <button class="filter-drawer-option"
                        [class.selected]="pendingBrand() === b.brand"
                        (click)="selectPendingBrand(b.brand)">
                  <span class="option-check">
                    @if (pendingBrand() === b.brand) { <i class="ri-checkbox-circle-fill"></i> }
                  </span>
                  {{ b.brandAlias || b.brand }}
                </button>
              }
            </div>
          }
        </div>
      }

      @for (group of availableFilters(); track group.slug) {
        <div class="filter-drawer-section">
          <div class="filter-drawer-section-title">
            <span>{{ group | localizedName }}</span>
          </div>
          <div class="filter-drawer-options">
            @for (v of group.values; track v.slug) {
              <button class="filter-drawer-option"
                      [class.selected]="isPendingFilterSelected(group.slug, v.slug)"
                      (click)="togglePendingFilter(group.slug, v.slug)">
                <span class="option-check">
                  @if (isPendingFilterSelected(group.slug, v.slug)) { <i class="ri-checkbox-circle-fill"></i> }
                </span>
                {{ v | localizedName:'value' }}
                <span class="option-count">({{ v.count }})</span>
              </button>
            }
          </div>
        </div>
      }
    </div>

    <div class="filter-drawer-footer">
      <button class="filter-drawer-apply" (click)="applyFiltersAndClose()">
        {{ 'ShowResults' | transloco }}
        @if (totalProductCount() > 0) {
          ({{ totalProductCount() }})
        }
      </button>
    </div>
  </p-drawer>

  <div class="catalog-layout">
    <!-- DESKTOP: sidebar filters (hidden on mobile) -->
    @if (hasFilters()) {
      <aside class="desktop-filters">
        <div class="sidebar-header">
          <span class="sidebar-title">{{ 'Filters' | transloco }}</span>
          @if (activeFilterCount() > 0) {
            <button class="clear-all-btn" (click)="clearAllFilters()">
              <i class="ri-close-line"></i>
              {{ 'ClearAll' | transloco }}
            </button>
          }
        </div>

        @if (availableBrands().length > 1) {
          <div class="sidebar-section">
            <span class="filter-title">{{ 'Brand' | transloco }}</span>
            <div class="filter-chips">
              <button
                class="filter-chip"
                [class.active]="selectedBrand() === null"
                (click)="selectBrand(null)">
                {{ 'AllBrands' | transloco }}
              </button>
              @for (b of availableBrands(); track b.brand) {
                <button
                  class="filter-chip"
                  [class.active]="selectedBrand() === b.brand"
                  (click)="selectBrand(b.brand)">
                  {{ b.brandAlias || b.brand }}
                </button>
              }
            </div>
          </div>
        }

        @for (group of availableFilters(); track group.slug) {
          <div class="sidebar-section">
            <span class="filter-title">{{ group | localizedName }}</span>
            <div class="filter-chips">
              @for (v of group.values; track v.slug) {
                <button class="filter-chip"
                        [class.active]="isFilterSelected(group.slug, v.slug)"
                        (click)="toggleFilter(group.slug, v.slug)">
                  {{ v | localizedName:'value' }} ({{ v.count }})
                </button>
              }
            </div>
          </div>
        }
      </aside>
    }

    <div class="product-list-panel">
      @if(products().length>0){
        <product-list [products]="products()"/>
      } @else {
        <app-empty-state/>
      }

      @if (!allLoaded() && products().length > 0) {
        <div class="load-more">
          <button
            class="load-more-btn"
            [disabled]="isLoading()"
            (click)="loadMore()"
          >
            @if (isLoading()) {
              {{ 'Loading...' | transloco }}
            } @else {
              {{ 'Load more' | transloco }}
            }
          </button>
        </div>
      }
    </div>
  </div>

  <!-- SEO Text Block -->
  @if (category() === 'vs') {
    <div class="seo-text-block">
      @if (activeLang() === 'ro') {
        <h2>Produse originale de la Victoria's Secret în Moldova</h2>
        <p>
          Bine ați venit în universul Victoria's Secret la Secret Room! Suntem mândri să vă oferim cea mai variată colecție de
          <strong>lenjerie intimă Victoria's Secret în Moldova</strong>. De la sutiene confortabile și chiloți eleganți, până la
          celebrele pijamale și halate, aici găsiți tot ce aveți nevoie pentru a vă simți încrezătoare și sexy.
        </p>
        <p>
          Pe lângă lenjerie, magazinul nostru online vă propune o gamă largă de produse cosmetice:
          <strong>parfumuri Victoria's Secret</strong>, loțiuni de corp hidratante și spray-uri parfumate care vă vor cuceri simțurile.
          Toate produsele sunt 100% originale, importate direct din SUA.
        </p>
        <h3>De ce să cumperi Victoria's Secret de la noi?</h3>
        <ul>
          <li>Produse originale garantate</li>
          <li>Livrare rapidă în Chișinău și pe tot teritoriul Moldovei</li>
          <li>Prețuri competitive și oferte speciale frecvente</li>
          <li>Consultanță profesionistă în alegerea mărimii potrivite</li>
        </ul>
      } @else {
        <h2>Оригинальные продукты от Victoria's Secret в Молдове</h2>
        <p>
          Добро пожаловать в мир Victoria's Secret в Secret Room! Мы гордимся тем, что предлагаем самую разнообразную коллекцию
          <strong>нижнего белья Victoria's Secret в Молдове</strong>. От удобных бюстгальтеров и элегантных трусиков до
          знаменитых пижам и халатов — здесь вы найдёте всё, чтобы чувствовать себя уверенно и привлекательно.
        </p>
        <p>
          Помимо белья, наш интернет-магазин предлагает широкий ассортимент косметики:
          <strong>парфюмы Victoria's Secret</strong>, увлажняющие лосьоны для тела и ароматические спреи, которые покорят ваши чувства.
          Все продукты 100% оригинальные, импортированные напрямую из США.
        </p>
        <h3>Почему стоит покупать Victoria's Secret у нас?</h3>
        <ul>
          <li>Гарантированная оригинальность продукции</li>
          <li>Быстрая доставка по Кишинёву и всей Молдове</li>
          <li>Конкурентные цены и частые специальные предложения</li>
          <li>Профессиональная консультация по подбору размера</li>
        </ul>
      }
    </div>
  } @else if (category() === 'bb') {
    <div class="seo-text-block">
      @if (activeLang() === 'ro') {
        <h2>Bath & Body Works Moldova</h2>
        <p>
          Transformați-vă rutina zilnică de îngrijire într-un ritual spa cu produsele <strong>Bath & Body Works</strong>, acum disponibile în Moldova prin Secret Room.
          Descoperiți aromele care au cucerit lumea: de la clasicul Japanese Cherry Blossom până la noile colecții sezoniere.
        </p>
        <p>
          În oferta noastră găsiți celebrele <strong>lumânări parfumate cu 3 fitile</strong>, care vor umple casa dvs. de o atmosferă caldă și primitoare.
          De asemenea, vă oferim geluri de duș, săpunuri spumante și creme de corp ultra-hidratante cu unt de shea.
        </p>
      } @else {
        <h2>Bath & Body Works в Молдове</h2>
        <p>
          Превратите ежедневный уход за собой в спа-ритуал с продуктами <strong>Bath & Body Works</strong>, теперь доступными в Молдове через Secret Room.
          Откройте для себя ароматы, покорившие весь мир: от классического Japanese Cherry Blossom до новых сезонных коллекций.
        </p>
        <p>
          В нашем ассортименте вы найдёте знаменитые <strong>ароматические свечи с 3 фитилями</strong>, которые наполнят ваш дом тёплой и уютной атмосферой.
          А также гели для душа, пенящееся мыло и ультраувлажняющие кремы для тела с маслом ши.
        </p>
      }
    </div>
  } @else if (brandName()) {
    <!-- Dynamic Brand SEO Text -->
    <div class="seo-text-block">
      @if (activeLang() === 'ro') {
        <h2>{{ brandAlias() || brandName() }} Moldova</h2>
        <p>
          Descoperă colecția exclusivă <strong>{{ brandAlias() || brandName() }}</strong> la Secret Room. Suntem destinația ta de încredere pentru produse originale {{ brandAlias() || brandName() }} în Moldova.
          Fie că ești în căutarea celor mai noi lansări sau a produselor clasice, magazinul nostru îți oferă o gamă variată la prețuri competitive.
        </p>
        <p>
          Comandă online produse <strong>{{ brandAlias() || brandName() }}</strong> cu livrare rapidă în Chișinău și în toată țara.
          Garantăm autenticitatea fiecărui produs din portofoliul nostru.
        </p>
      } @else {
        <h2>{{ brandAlias() || brandName() }} Молдова</h2>
        <p>
          Откройте для себя эксклюзивную коллекцию <strong>{{ brandAlias() || brandName() }}</strong> в Secret Room. Мы — ваш надёжный источник оригинальной продукции {{ brandAlias() || brandName() }} в Молдове.
          Ищете ли вы последние новинки или классические продукты — наш магазин предложит широкий выбор по конкурентным ценам.
        </p>
        <p>
          Заказывайте продукцию <strong>{{ brandAlias() || brandName() }}</strong> онлайн с быстрой доставкой по Кишинёву и всей стране.
          Мы гарантируем подлинность каждого продукта в нашем ассортименте.
        </p>
      }
    </div>
  }
</div>
